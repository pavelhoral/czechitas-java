module.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};const i=n(1),r=o(n(3)),s=o(n(4)),a=o(n(5)),l=n(6);let c,u,g=void 0;e.exports=function(e){const t=e.typescript;let n;return{create:function(e){const o=Object.create(null);for(let t of Object.keys(e.languageService)){const n=e.languageService[t];n&&(o[t]=n.bind(e.languageService))}function p(){if(!g&&c)try{const t=s.readFileSync(c),n=Buffer.from([214,105,172,23,156,35,36,45,137,37,195,176,189,110,127,78,69,171,205,160,3,202,114,220,252,109,233,221,252,181,45,47]),o=Buffer.from([60,12,128,217,163,220,176,146,213,18,190,59,212,88,192,21]),i=r.createDecipheriv("aes256",n,o),l=Buffer.concat([i.update(t),i.final()]),p=a.gunzipSync(l);g=JSON.parse(p.toString("utf-8")),u="typescript_"+(g.Version||"unknown"),e.languageServiceHost.log(`successfully loaded model from ${c}`)}catch(t){e.languageServiceHost.log(`failed to load model from ${c}, exception: ${t}`)}return g}return e.config.modelPath&&(c=e.config.modelPath),(n=e.languageServiceHost).log(`starting configuration: ${JSON.stringify(e.config)}`),o.getCompletionsAtPosition=((n,o,r)=>(function(e,t,n,o,r,s){const a=t.languageService.getCompletionsAtPosition(o,r,s),c=t.languageService.getProgram(),g=c?c.getSourceFile(o):void 0;if(a&&(a.entries.length>0||!g||!l.isInString(e,g,r))){const s=process.hrtime(),l=function(){const s=n(),a=s&&s.model;if(!a)return{recommendedWords:[]};let l;const c=t.languageService.getProgram();let u;if(c){t.languageServiceHost.log&&t.languageServiceHost.log("program found"),u=c.getTypeChecker();const n=c.getSourceFile(o);if(n&&(t.languageServiceHost.log&&t.languageServiceHost.log("source file found"),e.forEachChild(n,function n(o,s,a,c){function u(e,...t){e&&n(o,s,!0,e);for(const e of t)e&&n(o,s,a,e)}t.languageServiceHost.log&&t.languageServiceHost.log(`looking at node ${c.kind} ${c.getStart()} ${c.getEnd()} ${r}: ${c.getText(s)}`),e.isPropertyAccessExpression(c)&&r>c.getStart()&&r<=c.getEnd()&&function(n,o,r,s){t.languageServiceHost.log("found it!");const a=i.getTypeNameForPythia(e,i.GetTypeNameOptions.SkipAny,n,s.expression,o).typeName;a&&(l={typeName:a,node:s,isInConditional:r,sf:o},t.languageServiceHost.log(`found type name too! ${l.typeName} ${r?"in conditional":""}`))}(o,s,a,c),e.isIfStatement(c)?u(c.expression,c.thenStatement,c.elseStatement):e.isConditionalExpression(c)?u(c.condition,c.whenTrue,c.whenFalse):e.isDoStatement(c)||e.isWhileStatement(c)?u(c.expression,c.statement):e.isForStatement(c)?u(c.condition,c.initializer,c.incrementor,c.statement):c.forEachChild(n.bind(void 0,o,s,a))}.bind(void 0,u,n,!1)),l)){let n=void 0,o=[];t.languageServiceHost.log&&t.languageServiceHost.log(`determined type: ${l.typeName}`);const r=a[l.typeName];if(r){t.languageServiceHost.log("found some suggestion stuff");const s=function(n){const o=[];(function n(o,r,s,a){if(r.getStart()>s.getStart())return!0;if(r.forEachChild(e=>n(o,e,s,a)),e.isPropertyAccessExpression(r)&&r.expression!=s){const n=i.getTypeNameForPythia(e,i.GetTypeNameOptions.SkipAny,u,r.expression,l.sf).typeName;n===o&&r.name.text&&(t.languageServiceHost.log(`pushing prior access: ${r.name.text}`),a.push(r.name.text))}})(n,l.sf,l.node,o),o.reverse(),t.languageServiceHost.log(`prior accesses: ${o.join(",")}`);const r=[];return r.push("N"),o.length>0&&r.push("N~"+o[0]),o.length>1&&r.push(o[0]+"~"+o[1]),r.reverse(),t.languageServiceHost.log(`sequences: ${r.join(",")}`),r}(l.typeName);t.languageServiceHost.log(`sequences: ${s.join(",")}`);for(const e of s){const i=r[e],s=i&&(l.isInConditional?i[1]:i[0]);if(s){n=e,t.languageServiceHost.log(`found suggestions for sequence ${e} : ${s.join(",")}`),o.push(...s.slice(0,5));break}}}return{typeName:l.typeName,inConditional:l.isInConditional,sequenceString:n,recommendedWords:o}}}return{recommendedWords:[]}}(),c=1e6,g=1e9,m=process.hrtime(s),f=(m[0]*g+m[1])/c;let d="NotInModel",y=[];if(l.recommendedWords.length>0&&(d="NotInIntersection",a.entries=a.entries.filter(e=>!e.replacementSpan||!e.insertText||"["!==e.insertText[0]),a.entries.some(e=>"0"===e.sortText)?l.recommendedWords.forEach((e,n)=>{const o=a.entries.findIndex(t=>t.name===e);if(o>=0){const e=a.entries[o];t.languageServiceHost.log(`marking recommendation ${e.name}`),d="None",p(e,n),y.push(e),a.entries.splice(o,1)}}):(t.languageServiceHost.log("no strong recommendations, adding entries"),a.entries=a.entries.filter(e=>!l.recommendedWords.some(t=>e.name===t)),y=l.recommendedWords.map((t,n)=>{const o={name:t,kind:e.ScriptElementKind.memberVariableElement,sortText:"0"};return p(o,n),o})),a.entries=y.concat(a.entries)),l.typeName&&l.sequenceString){let e={ModelVersion:u||"typescript_unknown",Count:y.length,ModelType:l.sequenceString&&"N"!==l.sequenceString?"Sequence":"Frequency",FailureReason:d,Class:"NotInModel"!==d?l.typeName:"",InIf:!!l.inConditional,ElapsedTime:f,Methods:y.map(e=>e.insertText),PrevInvoc:l.sequenceString,ItemMetadata:Object.create(null)};a.entries.forEach((n,o)=>{const i={Id:"",Index:o,Method:o<y.length?n.insertText:""};e.ItemMetadata[n.name]=i,t.languageServiceHost.log(`adding item metadata ${n.name} => ${JSON.stringify(i)} to completion result`)}),t.languageServiceHost.log(`added metadata ${JSON.stringify(e)} to completion result`),a.metadata=e}}function p(e,n){e.insertText=e.insertText||e.name,e.sortText=e.sortText||e.name,e.name="★ "+e.name,e.sortText=`*${String.fromCharCode("a".charCodeAt(0)+n)} ${e.sortText}`,t.languageServiceHost.log(`sort text for entry ${e.name} is ${e.sortText}`)}return a})(t,e,p,n,o,r)),o.getCompletionEntryDetails=((t,n,o,i,r,s)=>(function(e,t,n,o,i,r,s,a,l){const c=r.startsWith("★ "),u=c?r.slice("★ ".length):r;c&&t.languageServiceHost.log(`stripped name for recommendation: ${u}`);const g=t.languageService.getCompletionEntryDetails(o,i,u,s,a,l);return g&&c&&(g.name="★ "+g.name,t.languageServiceHost.log(`starred name for recommendation: ${g.name}`)),g})(0,e,0,t,n,o,i,r,s)),o},onConfigurationChanged:function(e){n&&n.log(`received configuration command: ${JSON.stringify(e)}`),e.modelPath&&(c=e.modelPath)}}}},function(e,t,n){"use strict";t.__esModule=!0;var o,i,r=n(2);!function(e){e[e.DontSkipAny=0]="DontSkipAny",e[e.SkipAny=1]="SkipAny"}(o=t.GetTypeNameOptions||(t.GetTypeNameOptions={})),function(e){e[e.SkipAny=0]="SkipAny",e[e.Any=1]="Any",e[e.AnyCallExpression=2]="AnyCallExpression",e[e.AnyPropertyAccessExpression=3]="AnyPropertyAccessExpression",e[e.AnyElementAccessExpression=4]="AnyElementAccessExpression",e[e.UnionOrIntersection=5]="UnionOrIntersection",e[e.OtherPrimitive=6]="OtherPrimitive",e[e.OtherNonPrimitive=7]="OtherNonPrimitive",e[e.Literal=8]="Literal",e[e.EmptyIdentifier=9]="EmptyIdentifier"}(i=t.SkipTypeReason||(t.SkipTypeReason={})),t.getTypeNameForPythia=function e(t,n,s,a,l){var c=s.getTypeAtLocation(a),u=c.aliasSymbol||c.getSymbol();if(u){if(0!=(u.flags&(t.SymbolFlags.TypeLiteral|t.SymbolFlags.ObjectLiteral)))return{typeName:s.typeToString(c)};var g=s.getFullyQualifiedName(u);if(g&&'"'===g[0]){var p=(x=(v=g).indexOf('"',1))>=1?{partInQuotes:v.substring(1,x),rest:v.substring(x+1)}:{},m=p.partInQuotes,f=p.rest;if(m){var d=m;if(r.isAbsolute(d)){"index"===r.basename(d)&&(d=r.dirname(d));var y=d.lastIndexOf("/node_modules/");if(y>=0){var S=y+"/node_modules/".length;d=d.substring(S)}else d=r.basename(d);g='"'+d+'"'+(f||"")}}}return{typeName:g}}var v,x;if(0==(c.getFlags()&t.TypeFlags.NonPrimitive)){if(0!=(c.flags&t.TypeFlags.Any)){var h;if(t.isCallExpression(a))return(h=e(t,n,s,a.expression,l)).typeName?{typeName:h.typeName+"()"}:{skipReason:i.AnyCallExpression};if(t.isPropertyAccessExpression(a))return(h=e(t,n,s,a.expression,l)).typeName?{typeName:h.typeName+"."+a.name.text}:{skipReason:i.AnyPropertyAccessExpression};if(t.isElementAccessExpression(a))return(h=e(t,n,s,a.expression,l)).typeName?{typeName:h.typeName+"[]"}:{skipReason:i.AnyElementAccessExpression};if(n===o.SkipAny)return{skipReason:i.SkipAny};if(t.isIdentifier(a)){var N=a.text;return N?{typeName:N}:{skipReason:i.EmptyIdentifier}}return a.kind===t.SyntaxKind.ThisKeyword?{typeName:"this"}:{skipReason:i.Any}}return 0!=(c.flags&t.TypeFlags.StringLike)?{typeName:"string"}:0!=(c.flags&t.TypeFlags.Boolean)?{typeName:"boolean"}:0!=(c.flags&t.TypeFlags.NumberLike)?{typeName:"number"}:0!=(c.flags&t.TypeFlags.UnionOrIntersection)?{skipReason:i.UnionOrIntersection}:{skipReason:i.OtherPrimitive}}return{skipReason:i.OtherNonPrimitive}}},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("zlib")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isInString=function(e,t,n){const o=function(t,n){let o=t;e:for(;;){for(const i of o.getChildren(t)){const r=i.getStart(t);if(r>n)break;const s=i.getEnd();if(n<s||n===s&&i.kind===e.SyntaxKind.EndOfFileToken){o=i;continue e}}return o}}(t,n);if(o&&(e.isStringLiteral(o)||e.isTemplateLiteralToken(o))){const e=o.getStart(t),i=o.getEnd();if(e<n&&n<i)return!0;if(n===i)return!!o.isUnterminated}}}]);